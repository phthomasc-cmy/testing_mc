<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Year-based MCQ (Enhanced)</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --warning: #f39c12;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- Header Styles --- */
        header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 15px;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timer-display {
            font-family: monospace;
            font-size: 1.1rem;
            background: var(--dark);
            color: var(--light);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .music-btn {
            background-color: var(--warning);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* --- Standard UI --- */
        select, button {
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        select {
            border: 1px solid #ccc;
        }

        .btn-next {
            background-color: var(--primary);
            color: white;
            border: none;
            display: none;
            margin-top: 15px;
        }

        .question-area {
            text-align: center;
            margin-bottom: 20px;
        }

        .question-img, .answer-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background-color: white;
            border: 2px solid var(--dark);
            color: var(--dark);
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .option-btn:hover:not(:disabled) {
            background-color: var(--light);
        }

        /* State Styles */
        .option-btn.correct {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }

        .option-btn.wrong {
            background-color: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            display: none;
        }

        .feedback-area.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .feedback-text {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
        }

        /* --- History Section Styles --- */
        .history-container {
            margin-top: 30px;
            border-top: 2px solid var(--light);
            padding-top: 20px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .history-table th, .history-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .history-table th {
            background-color: var(--light);
            color: var(--dark);
        }

        .status-correct { color: var(--success); font-weight: bold; }
        .status-wrong { color: var(--danger); font-weight: bold; }

    </style>
</head>
<body>

<!-- Hidden Audio Element -->
<audio id="bgMusic" loop>
    <!-- ‰ΩøÁî®ÂÖçÁâàÁ®ÖÁöÑÁØÑ‰æãÈü≥Ê®ÇÈÄ£Áµê -->
    <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112762.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<div class="container">
    <header>
        <div>
            <label for="yearSelect"><strong>Select Year: </strong></label>
            <select id="yearSelect" onchange="resetQuiz()">
                <!-- Options populated by JS -->
            </select>
        </div>
        
        <div class="header-controls">
            <!-- Feature 1: Timer Display -->
            <div id="timerBox" class="timer-display">
                Total: 00:00 | Q: 00s
            </div>
            
            <!-- Feature 3: Music Button -->
            <button class="music-btn" onclick="toggleMusic()">üéµ Play Music</button>
        </div>
    </header>

    <div style="text-align: right; margin-bottom: 10px; font-weight: bold; color: #7f8c8d;" id="progress">
        Question 0 / 0
    </div>

    <!-- Start Screen -->
    <div id="startScreen" class="empty-state">
        <h2>Ready to practice?</h2>
        <p>Select a year above and click Start.</p>
        <button onclick="startQuiz()" style="background: var(--primary); color: white; border: none; padding: 15px 30px; font-size: 1.1rem;">Start Quiz</button>
    </div>

    <!-- Quiz Area -->
    <div id="quizInterface" style="display: none;">
        <div class="question-area">
            <img id="questionImage" src="" alt="Question" class="question-img">
        </div>

        <div class="options-grid">
            <button class="option-btn" onclick="checkAnswer('A')">A</button>
            <button class="option-btn" onclick="checkAnswer('B')">B</button>
            <button class="option-btn" onclick="checkAnswer('C')">C</button>
            <button class="option-btn" onclick="checkAnswer('D')">D</button>
        </div>

        <div id="feedback" class="feedback-area">
            <div id="feedbackText" class="feedback-text"></div>
            <p><strong>Explanation / Correct Answer:</strong></p>
            <img id="answerImage" src="" alt="Answer Explanation" class="answer-img">
            <br>
            <button class="btn-next" id="nextBtn" onclick="nextQuestion()">Next Question ‚ûú</button>
        </div>
    </div>

    <!-- Feature 2: History Log -->
    <div id="historySection" class="history-container" style="display: none;">
        <h3>üìù Session History</h3>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Q#</th>
                    <th>My Answer</th>
                    <th>Correct</th>
                    <th>Result</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="historyBody">
                <!-- Rows added by JS -->
            </tbody>
        </table>
    </div>
</div>

<script>
    // ==========================================
    // 1. DATA & CONFIG
    // ==========================================
    const answerKeys = {
        "2023": { 1: "B", 2: "D", 3: "C", 4: "A", 5: "B", 6: "D", 7: "B", 36: "B" },
        "2022": { 1: "C", 2: "C", 3: "A", 4: "B", 5: "D", 36: "A" },
        "2021": { 1: "B", 2: "A", 3: "D", 4: "C", 5: "A", 36: "C" }
    };

    function fillMockData() {
        const years = ["2023", "2022", "2021"];
        years.forEach(y => {
            if(!answerKeys[y]) answerKeys[y] = {};
            for(let i=1; i<=7; i++) {
                if(!answerKeys[y][i]) {
                    const opts = ['A','B','C','D'];
                    answerKeys[y][i] = opts[Math.floor(Math.random() * 4)];
                }
            }
        });
    }
    fillMockData(); 

    // ==========================================
    // 2. STATE VARIABLES
    // ==========================================
    let currentYear = "";
    let questionOrder = [];
    let currentIndex = 0;
    let isAnswered = false;

    // Timer Variables
    let timerInterval = null;
    let totalSeconds = 0;
    let questionSeconds = 0;
    let isTimerRunning = false;

    // Audio Variable
    let isMusicPlaying = false;
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = 0.3; // Set volume to 30%

    // ==========================================
    // 3. INITIALIZATION
    // ==========================================
    const yearSelect = document.getElementById('yearSelect');
    Object.keys(answerKeys).forEach(year => {
        let option = document.createElement("option");
        option.value = year;
        option.text = year;
        yearSelect.appendChild(option);
    });

    // ==========================================
    // 4. CORE LOGIC
    // ==========================================

    function resetQuiz() {
        stopTimer();
        document.getElementById('startScreen').style.display = 'block';
        document.getElementById('quizInterface').style.display = 'none';
        document.getElementById('historySection').style.display = 'none';
        document.getElementById('progress').innerText = "Question 0 / 0";
        document.getElementById('timerBox').innerText = "Total: 00:00 | Q: 00s";
        
        // Clear History Table
        document.getElementById('historyBody').innerHTML = "";
    }

    function startQuiz() {
        currentYear = yearSelect.value;
        questionOrder = Array.from({length: 7}, (_, i) => i + 1);
        shuffleArray(questionOrder);
        
        currentIndex = 0;
        
        // Reset Timers
        totalSeconds = 0;
        questionSeconds = 0;
        
        // UI Updates
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('quizInterface').style.display = 'block';
        document.getElementById('historySection').style.display = 'block';
        
        loadQuestion();
        startTimer(); // Start the clock
    }

    function loadQuestion() {
        if (currentIndex >= questionOrder.length) {
            stopTimer();
            alert(`Quiz Finished!\nTotal Time: ${formatTime(totalSeconds)}`);
            return;
        }

        isAnswered = false;
        questionSeconds = 0; // Reset question timer specific to this question
        const qNum = questionOrder[currentIndex];

        document.getElementById('progress').innerText = `Question ${currentIndex + 1} / ${questionOrder.length} (ID: ${qNum})`;

        // --- IMAGE PATH LOGIC ---
        // Change these URLs to your local path: `images/${currentYear}/q_${qNum}.jpg`
        const qSrc = `images/${currentYear}/q_${qNum}.JPG`;
        const aSrc = `images/${currentYear}/a_${qNum}.JPG`;

        document.getElementById('questionImage').src = qSrc;
        document.getElementById('answerImage').src = aSrc;

        document.getElementById('feedback').classList.remove('show');
        document.getElementById('nextBtn').style.display = 'none';
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(btn => {
            btn.disabled = false;
            btn.classList.remove('correct', 'wrong');
        });
    }

    function checkAnswer(selectedOption) {
        if (isAnswered) return;
        isAnswered = true;

        const qNum = questionOrder[currentIndex];
        const correctOption = answerKeys[currentYear][qNum];
        
        const feedbackDiv = document.getElementById('feedback');
        const feedbackText = document.getElementById('feedbackText');
        const btns = document.querySelectorAll('.option-btn');

        // Visual Feedback
        btns.forEach(btn => {
            btn.disabled = true;
            if (btn.innerText === correctOption) btn.classList.add('correct');
            if (btn.innerText === selectedOption && selectedOption !== correctOption) btn.classList.add('wrong');
        });

        // Text Feedback
        let isCorrect = (selectedOption === correctOption);
        if (isCorrect) {
            feedbackText.innerHTML = `<span style="color:var(--success)">‚úî Correct!</span>`;
            feedbackDiv.style.border = "2px solid var(--success)";
        } else {
            feedbackText.innerHTML = `<span style="color:var(--danger)">‚úò Incorrect. The answer was ${correctOption}.</span>`;
            feedbackDiv.style.border = "2px solid var(--danger)";
        }

        feedbackDiv.classList.add('show');
        document.getElementById('nextBtn').style.display = 'inline-block';

        // Add to History (Feature 2)
        addToHistory(qNum, selectedOption, correctOption, isCorrect, questionSeconds);
    }

    function nextQuestion() {
        currentIndex++;
        loadQuestion();
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // ==========================================
    // 5. NEW FEATURES LOGIC
    // ==========================================

    /* --- Feature 1: Timer Logic --- */
    function startTimer() {
        if(isTimerRunning) return;
        isTimerRunning = true;
        timerInterval = setInterval(() => {
            totalSeconds++;
            // Only increment question timer if we haven't answered yet
            if(!isAnswered) {
                questionSeconds++;
            }
            updateTimerDisplay();
        }, 1000);
    }

    function stopTimer() {
        isTimerRunning = false;
        clearInterval(timerInterval);
    }

    function updateTimerDisplay() {
        const totalFmt = formatTime(totalSeconds);
        document.getElementById('timerBox').innerHTML = `Total: ${totalFmt} | Q: ${questionSeconds}s`;
    }

    function formatTime(secs) {
        const m = Math.floor(secs / 60).toString().padStart(2, '0');
        const s = (secs % 60).toString().padStart(2, '0');
        return `${m}:${s}`;
    }

    /* --- Feature 2: History Logic --- */
    function addToHistory(qNum, myAns, correctAns, isCorrect, timeTaken) {
        const tbody = document.getElementById('historyBody');
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>#${qNum}</td>
            <td>${myAns}</td>
            <td>${correctAns}</td>
            <td class="${isCorrect ? 'status-correct' : 'status-wrong'}">
                ${isCorrect ? '‚úî Correct' : '‚úò Wrong'}
            </td>
            <td>${timeTaken}s</td>
        `;
        
        // Insert at the top
        tbody.prepend(row);
    }

    /* --- Feature 3: Music Logic --- */
    function toggleMusic() {
        if (isMusicPlaying) {
            bgMusic.pause();
            document.querySelector('.music-btn').innerText = "üéµ Play Music";
            isMusicPlaying = false;
        } else {
            // Some browsers block audio unless triggered by user interaction (which this click is)
            bgMusic.play().then(() => {
                document.querySelector('.music-btn').innerText = "‚è∏ Pause Music";
                isMusicPlaying = true;
            }).catch(e => {
                console.log("Audio play failed:", e);
                alert("Could not play audio. Please check browser permissions.");
            });
        }
    }

</script>

</body>
</html>